{% extends 'base.html' %}
{% load static humanize%}

{% block title %}Lịch sử đơn hàng{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/orders.css' %}">
{% endblock %}

{% block content %}
<div class="orders-page">
  <h1 class="page-title">Lịch sử đơn hàng</h1>

  <div class="order-tabs">
      <a href="{% url 'orders:list' %}"
         class="order-tab {% if not current_status %}active{% endif %}">
          Tất cả
      </a>
      <a href="?status=pending"
         class="order-tab {% if current_status == 'pending' %}active{% endif %}">
          Chờ xác nhận
      </a>
      <a href="?status=confirmed"
         class="order-tab {% if current_status == 'confirmed' %}active{% endif %}">
          Đã xác nhận
      </a>
      <a href="?status=shipped"
         class="order-tab {% if current_status == 'shipped' %}active{% endif %}">
          Đang giao
      </a>
      <a href="?status=completed"
         class="order-tab {% if current_status == 'completed' %}active{% endif %}">
          Đã giao thành công
      </a>
      <a href="?status=cancelled"
         class="order-tab {% if current_status == 'cancelled' %}active{% endif %}">
          Hủy bởi người dùng
      </a>
      <a href="?status=rejected"
         class="order-tab {% if current_status == 'rejected' %}active{% endif %}">
          Bị từ chối bởi admin
      </a>
  </div>

  {% if orders %}
    <table class="orders-table">
      <thead>
        <tr>
          <th>Ngày đặt</th>
          <th>Tổng tiền</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.order_date|date:"d/m/Y H:i" }}</td>
          <td>{{ order.total_amount|floatformat:0|intcomma }} VNĐ</td>
          <td>
            <span class="order-status {{ order.status }}">
              {{ order.get_status_display }}
            </span>
          </td>
          <td>
            <a href="{% url 'orders:detail' order.id %}" class="btn btn-outline-secondary btn-sm">
              Xem chi tiết
            </a>
            {% if order.status == 'pending' %}
              <form action="{% url 'orders:cancel' order.id %}"
                    method="post"
                    class="inline-form">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('Bạn chắc chắn muốn hủy đơn này?');">
                  Hủy đơn
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Bạn chưa có đơn hàng nào.</p>
  {% endif %}
</div>
{% endblock %}
