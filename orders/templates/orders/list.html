{% extends 'base.html' %}
{% load static humanize i18n %}

{% block title %}{% trans "Lịch sử đơn hàng" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/orders.css' %}">
{% endblock %}

{% block content %}
<div class="orders-page">
  <h1 class="page-title">{% trans "Lịch sử đơn hàng" %}</h1>

  <div class="order-tabs">
      <a href="{% url 'orders:list' %}"
         class="order-tab {% if not current_status %}active{% endif %}">
          {% trans "Tất cả" %}
      </a>
      <a href="?status=pending"
         class="order-tab {% if current_status == 'pending' %}active{% endif %}">
          {% trans "Chờ xác nhận" %}
      </a>
      <a href="?status=confirmed"
         class="order-tab {% if current_status == 'confirmed' %}active{% endif %}">
          {% trans "Đã xác nhận" %}
      </a>
      <a href="?status=shipped"
         class="order-tab {% if current_status == 'shipped' %}active{% endif %}">
          {% trans "Đang giao" %}
      </a>
      <a href="?status=completed"
         class="order-tab {% if current_status == 'completed' %}active{% endif %}">
          {% trans "Đã giao thành công" %}
      </a>
      <a href="?status=cancelled"
         class="order-tab {% if current_status == 'cancelled' %}active{% endif %}">
          {% trans "Hủy bởi người dùng" %}
      </a>
      <a href="?status=rejected"
         class="order-tab {% if current_status == 'rejected' %}active{% endif %}">
          {% trans "Bị từ chối bởi admin" %}
      </a>
  </div>

  {% if orders %}
    <table class="orders-table">
      <thead>
        <tr>
          <th>{% trans "Ngày đặt" %}</th>
          <th>{% trans "Tổng tiền" %}</th>
          <th>{% trans "Trạng thái" %}</th>
          <th>{% trans "Hành động" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td data-label="{% trans "Ngày đặt" %}">{{ order.order_date|date:"d/m/Y H:i" }}</td>
          <td data-label="{% trans "Tổng tiền" %}">{{ order.total_amount|floatformat:0|intcomma }} {% trans "VNĐ" %}</td>
          <td data-label="{% trans "Trạng thái" %}">
            <span class="order-status {{ order.status }}">
              {{ order.get_status_display }}
            </span>
          </td>
          <td data-label="{% trans "Hành động" %}">
            <a href="{% url 'orders:detail' order.id %}" class="btn btn-outline-secondary btn-sm">
              {% trans "Xem chi tiết" %}
            </a>
            {% if order.status == 'pending' %}
              <form action="{% url 'orders:cancel' order.id %}"
                    method="post"
                    class="inline-form">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('{% trans "Bạn chắc chắn muốn hủy đơn này?" %}');">
                      {% trans "Hủy đơn" %}
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>{% trans "Bạn chưa có đơn hàng nào." %}</p>
  {% endif %}
</div>
{% endblock %}
